apiVersion: v1
kind: Secret
metadata:
  name: {{ include "postgresql-migration.fullname" . }}-secret
  labels:
    {{- include "postgresql-migration.labels" . | nindent 4 }}
data:
    {{- range $path, $bytes := .Files.Glob "secrets/**" }}
    {{- $name := base $path }}
    {{ $name }}: |-
        {{- tpl ($.Files.Get (printf "%s" $path)) $ | trimAll "\n" | b64enc | nindent 8 }}
    {{- end -}}

{{- if not .Values.bucardo }}
{{- fail "Bucardo session in values must be specified!" }}
{{- end }}
